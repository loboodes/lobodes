<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800;900&display=swap');
    :root{
      --primary:#344695;
      --secondary:#344695;
      --dark:#344695;
      --light:#d1fae5;
      --accent:#fbbf24;
      --lab-color:#8b5cf6;
      --lab-dark:#7c3aed;
      --lab-light:#ede9fe;
      --text:#0f172a;
      --gray:#475569;
      --container:94vw;
      --card-bg:#ffffff;
      --shadow:0 4px 12px rgba(16,185,129,.1);
    }
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
    html, body{
      font-family:'Tajawal',sans-serif;
      background:linear-gradient(135deg,#f0fdf4 0%,#dcfce7 50%,#f0fdf4 100%);
      color:var(--text);
      line-height:1.65;
      min-height:100vh;
      overflow-x:hidden;
      font-size:16px;
    }
    .header-logo{
      background:#fff;
      position:sticky;
      top:0;
      z-index:1000;
      box-shadow:0 4px 12px rgba(16,185,129,.1);
      border-bottom:2px solid var(--light);
      padding:8px 0;
    }
    .header-logo .wrap{
      width:var(--container);
      max-width:1200px;
      margin:0 auto;
      padding:0 12px;
      display:flex;
      justify-content:center;
      align-items:center;
      flex-direction:column;
    }
    .header-logo img{
      height:84px;
      width:auto;
      object-fit:contain;
    }
    .header-text{text-align:center;margin-top:10px;}
    .header-text h1{color:var(--dark);font-size:1.8rem;margin-bottom:5px;}
    .header-text p{color:var(--gray);font-size:1rem;}
    .quran-verse{margin-top:10px;font-size:1.1rem;font-weight:500;color:var(--dark);}

    nav{
      background:linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      padding: 15px 0;
      box-shadow: 0 4px 12px rgba(16,185,129,.2);
    }
    .nav-container{width:var(--container);max-width:1200px;margin:0 auto;padding:0 12px;}
    .nav-title{color:#fff;text-align:center;margin-bottom:15px;font-size:1.3rem;font-weight:700;}
    .cards-container{
      display:grid;
      grid-template-columns:repeat(auto-fill,minmax(260px,1fr));
      gap:18px;
    }
    .card{
      background:var(--card-bg);
      border-radius:12px;
      padding:18px;
      box-shadow:var(--shadow);
      transition:all .25s;
      cursor:pointer;
      border:1px solid rgba(0,0,0,.04);
      text-align:center;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
    }
    .card:hover{transform:translateY(-4px);box-shadow:0 10px 20px rgba(0,0,0,.15);}
    .card .icon{
      font-size:2.2rem;
      width:62px;height:62px;
      display:flex;align-items:center;justify-content:center;
      border-radius:999px;
      background:rgba(16,185,129,.08);
      color:var(--primary);
      margin-bottom:4px;
    }
    .card .title{font-size:1.05rem;font-weight:800;color:var(--dark);}
    .card .subtitle{font-size:.8rem;color:#6b7280;display:flex;flex-wrap:wrap;gap:6px;justify-content:center;}
    .card .subtitle span{
      background:#e5e7eb;
      padding:3px 9px;
      border-radius:999px;
      font-size:.75rem;
    }
    .card.featured{border-top:3px solid var(--accent);}
    .card.labs{border-top:3px solid var(--lab-color);}
    .card.labs .icon{background:rgba(139,92,246,.12);color:var(--lab-color);}

    #iframe-container{width:100%;height:80vh;display:none;margin-top:20px;padding:0 1rem;}
    #content-frame{width:100%;height:100%;border-radius:12px;box-shadow:var(--shadow);border:none;}

    #local-pages{width:100%;max-width:1200px;margin:20px auto 40px;padding:0 1rem 80px;display:none;}
    .card-page{
      background:linear-gradient(135deg,#ffffff 0%,#ecfdf5 100%);
      padding:22px;
      border-radius:18px;
      box-shadow:0 10px 30px rgba(15,118,110,.12);
    }
    .wait-title,.lab-title,.general-title{
      color:var(--dark);
      text-align:center;
      margin-bottom:10px;
      font-size:1.4rem;
      font-weight:900;
    }
    .lab-title{color:var(--lab-dark);}
    .general-title{color:#155e75;}
    .wait-intro,.lab-intro,.general-intro{
      text-align:center;
      color:var(--gray);
      font-size:.95rem;
      margin-bottom:18px;
    }

    .form{display:grid;gap:14px;}
    .grid-3{display:grid;grid-template-columns:1fr;gap:10px;}
    @media (min-width:768px){.grid-3{grid-template-columns:repeat(3,1fr);}}
    label{display:flex;flex-direction:column;gap:6px;color:var(--text);font-weight:600;font-size:.88rem;}
    .input,textarea,select{
      width:100%;
      padding:9px 11px;
      border-radius:10px;
      border:2px solid #bbf7d0;
      background:#fefdf9;
      font-family:'Tajawal',sans-serif;
      font-size:.95rem;
      transition:all .2s;
      color:var(--text);
    }
    textarea{min-height:90px;resize:vertical;}
    .input:focus,textarea:focus,select:focus{
      outline:none;border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(16,185,129,.18);
      background:#fff;
    }
    .lab-form .input,.lab-form textarea{border-color:var(--lab-light);}
    .lab-form .input:focus,.lab-form textarea:focus{
      border-color:var(--lab-color);
      box-shadow:0 0 0 3px rgba(139,92,246,.18);
    }

    .chipset{display:flex;flex-wrap:wrap;gap:8px;margin-top:6px;}
    .chip{
      display:flex;align-items:center;gap:6px;
      background:linear-gradient(135deg,#ecfdf5,#dcfce7);
      padding:7px 10px;border-radius:999px;
      border:1px solid #bbf7d0;
      font-size:.82rem;cursor:pointer;transition:all .2s;
    }
    .chip input{width:15px;height:15px;accent-color:var(--primary);cursor:pointer;}
    .chip:hover{transform:translateY(-1px);box-shadow:0 4px 10px rgba(16,185,129,.25);}

    .actions{display:flex;flex-direction:column;gap:8px;margin-top:6px;}
    @media (min-width:768px){.actions{flex-direction:row;}}
    .btn{
      border:none;border-radius:14px;
      padding:9px 16px;font-weight:800;font-size:.9rem;
      cursor:pointer;
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;
      box-shadow:0 4px 15px rgba(16,185,129,.4);
      transition:all .2s;
      width:100%;text-align:center;
    }
    .btn:hover{transform:translateY(-1px);box-shadow:0 6px 18px rgba(16,185,129,.5);}
    .btn:active{transform:scale(.98);}
    .btn.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);box-shadow:0 4px 15px rgba(185,28,28,.4);}
    .lab-form .btn{
      background:linear-gradient(135deg,var(--lab-color),var(--lab-dark));
      box-shadow:0 4px 15px rgba(139,92,246,.4);
    }

    .date-with-hijri{position:relative;}
    .date-input-container{position:relative;display:flex;align-items:center;}
    .date-input-container .input{padding-right:44px;cursor:pointer;}
    .hijri-toggle{
      position:absolute;left:7px;top:50%;transform:translateY(-50%);
      background:transparent;border:none;cursor:pointer;
      width:28px;height:28px;border-radius:999px;
      display:flex;align-items:center;justify-content:center;
      transition:all .2s;
    }
    .hijri-toggle:hover{background:rgba(16,185,129,.12);}
    .hijri-icon{width:18px;height:18px;fill:var(--dark);}
    .hijri-calendar{
      position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);
      background:#fff;border-radius:14px;
      box-shadow:0 10px 30px rgba(15,118,110,.2);
      padding:12px;z-index:1500;width:90vw;max-width:320px;
      border:2px solid #bbf7d0;display:none;
    }
    .hijri-calendar.active{display:block;animation:fadeIn .25s ease;}
    .hijri-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;padding-bottom:6px;border-bottom:1px solid #e5e7eb;}
    .hijri-month-year{font-weight:700;color:var(--dark);font-size:.95rem;}
    .hijri-nav{display:flex;gap:4px;}
    .hijri-nav button{
      background:#ecfdf5;border:none;border-radius:6px;
      padding:3px 7px;cursor:pointer;font-size:.75rem;
      font-weight:700;color:var(--dark);transition:all .2s;
    }
    .hijri-nav button:hover{background:var(--primary);color:#fff;}
    .hijri-weekdays{
      display:grid;grid-template-columns:repeat(7,1fr);
      text-align:center;font-weight:700;color:var(--dark);
      font-size:.75rem;margin-bottom:4px;
    }
    .hijri-days{display:grid;grid-template-columns:repeat(7,1fr);gap:4px;}
    .hijri-day{
      padding:6px 2px;text-align:center;border-radius:6px;
      cursor:pointer;font-size:.78rem;color:var(--text);
      transition:all .2s;
    }
    .hijri-day:hover{background:#ecfdf5;}
    .hijri-day.selected{background:var(--primary);color:#fff;}
    .today-btn{
      margin-top:8px;width:100%;padding:7px 10px;
      border:none;border-radius:8px;cursor:pointer;
      font-weight:700;font-size:.8rem;
      background:#ecfdf5;color:var(--dark);
      transition:all .2s;
    }
    .today-btn:hover{background:var(--primary);color:#fff;}

    .wait-subtitle,.lab-subtitle,.general-subtitle{
      margin-top:20px;margin-bottom:8px;font-size:1.05rem;
      color:var(--dark);font-weight:800;border-right:4px solid var(--accent);
      padding-right:8px;
    }
    .lab-subtitle{border-right-color:var(--lab-color);color:var(--lab-dark);}
    .general-subtitle{border-right-color:#0ea5e9;color:#075985;}

    .table-wrap{
      margin-top:8px;border-radius:12px;overflow:hidden;
      box-shadow:0 6px 18px rgba(15,118,110,.12);
      overflow-x:auto;background:#fff;
    }
    table{width:100%;border-collapse:collapse;min-width:750px;font-size:.8rem;}
    th,td{padding:8px 6px;border-bottom:1px solid #e5e7eb;text-align:center;}
    th{
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;font-weight:800;font-size:.78rem;white-space:nowrap;
    }
    .lab-table th{background:linear-gradient(135deg,var(--lab-color),var(--lab-dark));}
    .general-table th{background:linear-gradient(135deg,#0ea5e9,#0369a1);}
    tbody tr:nth-child(even){background:#f9fafb;}
    tbody tr:hover{background:#ecfdf5;}
    td.text-right{text-align:right;}

    .report-header{
      background:linear-gradient(135deg,#14532d,#166534);
      color:#fff;padding:14px 16px;border-radius:10px;
      margin-bottom:18px;text-align:center;
      box-shadow:0 4px 12px rgba(0,0,0,.08);
      border:1px solid rgba(255,255,255,.2);
    }
    .report-header h2{font-size:1.4rem;margin-bottom:10px;font-weight:800;text-shadow:1px 1px 2px rgba(0,0,0,.18);}
    .report-header .ministry{font-size:1.05rem;font-weight:700;margin-bottom:4px;}
    .report-header .program-title{font-size:1.25rem;font-weight:800;margin-top:8px;padding:8px 12px;background:rgba(255,255,255,.12);border-radius:8px;display:inline-block;}

    .toast{
      position:fixed;top:90px;left:50%;transform:translateX(-50%);
      background:linear-gradient(135deg,var(--primary),var(--secondary));
      color:#fff;padding:9px 14px;border-radius:999px;
      font-size:.85rem;font-weight:700;box-shadow:0 8px 20px rgba(15,118,110,.4);
      z-index:2000;animation:fadeIn .25s ease;max-width:90%;text-align:center;
    }
    .toast.warn{background:linear-gradient(135deg,#facc15,#eab308);color:#111827;}
    .toast.danger{background:linear-gradient(135deg,#ef4444,#b91c1c);}
    @keyframes fadeIn{from{opacity:0;transform:translate(-50%,-10px);}to{opacity:1;transform:translate(-50%,0);}}

    .site-footer{background:linear-gradient(135deg,var(--primary),var(--dark));color:#fff;padding:15px;text-align:center;box-shadow:0 -4px 20px rgba(0,0,0,.15);margin-top:30px;}
    .site-footer p{margin:5px 0;font-size:14px;}

    #back-btn{
      position:fixed;top:20px;right:20px;z-index:1000;
      background:var(--primary);color:white;border:none;
      padding:10px 15px;border-radius:5px;cursor:pointer;
      font-family:'Tajawal',sans-serif;box-shadow:0 2px 10px rgba(0,0,0,.2);
      display:none;
    }

    @media (max-width:768px){
      .cards-container{grid-template-columns:repeat(auto-fill,minmax(250px,1fr));}
      .header-text h1{font-size:1.5rem;}
      .card-page{padding:18px;}
      .report-header{padding:15px;}
      .report-header h2{font-size:1.3rem;}
    }
    @media (max-width:480px){
      .cards-container{grid-template-columns:1fr;}
      .header-text h1{font-size:1.3rem;}
      .report-header h2{font-size:1.15rem;}
    }
  </style>
</head>
<body>

<header class="header-logo">
  <div class="wrap">
    <img src="https://raw.githubusercontent.com/loboodes/lobodes/refs/heads/main/documents/lobodes11.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù†Ø¸Ø§Ù…">
    <div class="header-text">
      <h1>Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©</h1>
      <p>Ù…Ù†ØµØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³ÙŠØ©</p>
    </div>
    <div class="quran-verse">ï´¿ ÙˆÙÙ‚ÙÙ„Ù’ Ø±ÙØ¨ÙÙ‘ Ø²ÙØ¯Ù’Ù†ÙÙŠ Ø¹ÙÙ„Ù’Ù…Ù‹Ø§ ï´¾</div>
  </div>
</header>

<nav>
  <div class="nav-container">
    <div class="nav-title">ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</div>
    <div class="cards-container">
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/R1397/', 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±')">
        <div class="icon">ğŸ—“ï¸</div>
        <div class="title">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
        <div class="subtitle"><span>Ø§Ù„ÙŠÙˆÙ…ÙŠ</span><span>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span><span>Ø§Ù„Ø´Ù‡Ø±ÙŠ</span></div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/A1397/', 'Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ')">
        <div class="icon">ğŸŒŸ</div>
        <div class="title">Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/AC1397/', 'Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù„Ø§ØµÙÙŠØ©')">
        <div class="icon">ğŸ§©</div>
        <div class="title">Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ù„Ø§ØµÙÙŠØ©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/Trace1397/', 'Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©')">
        <div class="icon">ğŸ“‹</div>
        <div class="title">Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø£Ù†Ø´Ø·Ø©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/L1397/', 'Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±')">
        <div class="icon">ğŸ“</div>
        <div class="title">Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/T1397/', 'Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ')">
        <div class="icon">ğŸ“</div>
        <div class="title">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„Ø·Ù„Ø§Ø¨ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/V1397/', 'ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª')">
        <div class="icon">ğŸ“</div>
        <div class="title">ØªØ¨Ø§Ø¯Ù„ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/P1397/', 'Ø®Ø±ÙŠØ·Ø© Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù‘Ù…')">
        <div class="icon">ğŸ—ºï¸</div>
        <div class="title">Ø®Ø±ÙŠØ·Ø© Ù†ÙˆØ§ØªØ¬ Ø§Ù„ØªØ¹Ù„Ù‘Ù…</div>
      </div>
      <div class="card featured" onclick="loadLocal('wait')">
        <div class="icon">ğŸ•’</div>
        <div class="title">Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
      </div>
      <div class="card labs" onclick="loadLocal('lab')">
        <div class="icon">ğŸ”¬</div>
        <div class="title">Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
      </div>
      <div class="card featured" onclick="loadLocal('general')">
        <div class="icon">ğŸ“„</div>
        <div class="title">ØªÙ‚Ø±ÙŠØ± Ø¹Ø§Ù…</div>
        <div class="subtitle"><span>ÙŠÙˆÙ…ÙŠ</span><span>Ø£Ø³Ø¨ÙˆØ¹ÙŠ</span><span>Ø´Ù‡Ø±ÙŠ</span></div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/PLC1397/', 'Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠØ©')">
        <div class="icon">ğŸ“‘</div>
        <div class="title">Ù…Ø¬ØªÙ…Ø¹Ø§Øª Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù…Ù‡Ù†ÙŠØ©</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/D1397/', 'Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµØ­Ù‘ÙŠ')">
        <div class="icon">âš•ï¸</div>
        <div class="title">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ø§Ù„ØµØ­Ù‘ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/S1397/', 'Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù†Ø´Ø·')">
        <div class="icon">â™Ÿ</div>
        <div class="title">Ø§Ù„ØªØ¹Ù„Ù‘Ù… Ø§Ù„Ù†Ø´Ø·</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/LessonA1397/', 'Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠ')">
        <div class="icon">ğŸ“š</div>
        <div class="title">Ø§Ù„Ø¯Ø±Ø³ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ÙŠ</div>
      </div>
      <div class="card" onclick="loadInIframe('https://defullah2010-svg.github.io/Warshah1397/', 'ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„')">
        <div class="icon">ğŸ› ï¸</div>
        <div class="title">ÙˆØ±Ø´ Ø§Ù„Ø¹Ù…Ù„</div>
      </div>
    </div>
  </div>
</nav>

<main id="local-pages">
  <!-- Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± -->
  <section id="wait-section" class="card-page" style="display:none;">
    <div class="report-header">
      <h2>ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ°</h2>
      <div class="ministry">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="program-title">Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</div>
    </div>

    <p class="wait-intro">Ø³Ø¬Ù„ÙŠ ØªÙØ§ØµÙŠÙ„ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„ØªÙŠ Ù‚Ù…ØªÙ Ø¨ØªÙ†ÙÙŠØ°Ù‡Ø§. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</p>

    <form id="sesForm" class="form">
      <div class="grid-3">
        <label>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ *
          <select class="input" id="weekNumber" required>
            <option value="">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</option>
            <option>Ø§Ù„Ø£ÙˆÙ„</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ</option><option>Ø§Ù„Ø«Ø§Ù„Ø«</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø®Ø§Ù…Ø³</option>
            <option>Ø§Ù„Ø³Ø§Ø¯Ø³</option><option>Ø§Ù„Ø³Ø§Ø¨Ø¹</option><option>Ø§Ù„Ø«Ø§Ù…Ù†</option><option>Ø§Ù„ØªØ§Ø³Ø¹</option><option>Ø§Ù„Ø¹Ø§Ø´Ø±</option>
            <option>Ø§Ù„Ø­Ø§Ø¯ÙŠ Ø¹Ø´Ø±</option><option>Ø§Ù„Ø«Ø§Ù†ÙŠ Ø¹Ø´Ø±</option><option>Ø§Ù„Ø«Ø§Ù„Ø« Ø¹Ø´Ø±</option><option>Ø§Ù„Ø±Ø§Ø¨Ø¹ Ø¹Ø´Ø±</option><option>Ø§Ù„Ø®Ø§Ù…Ø³ Ø¹Ø´Ø±</option>
          </select>
        </label>
        <label>Ø§Ù„ÙŠÙˆÙ… *
          <select class="input" id="dayName" required>
            <option value="">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ÙŠÙˆÙ…</option>
            <option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†</option><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option><option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option>
          </select>
        </label>
        <label class="date-with-hijri">Ø§Ù„ØªØ§Ø±ÙŠØ® (Ù‡Ø¬Ø±ÙŠ) *
          <div class="date-input-container">
            <input class="input hijri-date-input" id="sessionDate" required placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ" readonly>
            <button type="button" class="hijri-toggle">
              <svg class="hijri-icon" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5zm2 4h10v2H7v-2zm0 4h7v2H7v-2z"/></svg>
            </button>
          </div>
          <div class="hijri-calendar">
            <div class="hijri-header">
              <div class="hijri-month-year"></div>
              <div class="hijri-nav">
                <button type="button" class="prev-year">Â«</button>
                <button type="button" class="prev-month">â€¹</button>
                <button type="button" class="next-month">â€º</button>
                <button type="button" class="next-year">Â»</button>
              </div>
            </div>
            <div class="hijri-weekdays">
              <span>Ø­</span><span>Ù†</span><span>Ø«</span><span>Ø±</span><span>Ø®</span><span>Ø¬</span><span>Ø³</span>
            </div>
            <div class="hijri-days"></div>
            <button type="button" class="today-btn">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</button>
          </div>
        </label>
      </div>

      <div class="grid-3">
        <label>Ø§Ù„ØµÙ / Ø§Ù„ÙØµÙ„ *
          <input class="input" id="className" required placeholder="Ù…Ø«Ø§Ù„: 2 / Ø£">
        </label>
        <label>Ø±Ù‚Ù… Ø§Ù„Ø­ØµØ© *
          <input class="input" id="sessionNumber" required placeholder="Ù…Ø«Ø§Ù„: 3">
        </label>
        <label>Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø§Ù„ØºØ§Ø¦Ø¨Ø© *
          <input class="input" id="absentTeacher" required placeholder="Ù…Ø«Ø§Ù„: Ø£/ Ø³Ø§Ø±Ø© Ù…Ø­Ù…Ø¯">
        </label>
      </div>

      <label>Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡ Ù…Ø¹ Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª *
        <textarea class="input" id="activitiesText" required placeholder="Ø§ÙƒØªØ¨ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø² Ù…Ø§ ØªÙ… Ø¹Ù…Ù„Ù‡ ÙÙŠ Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±..."></textarea>
      </label>

      <label>Ø§Ù„Ù…Ø¬Ø§Ù„ / Ù†ÙˆØ¹ Ø§Ù„Ù†Ø´Ø§Ø· *
        <div class="chipset">
          <label class="chip">
            <input type="checkbox" id="basicSkills">
            <span>Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</span>
          </label>
          <label class="chip">
            <input type="checkbox" id="values">
            <span>Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ø·Ù†Ø© Ø§Ù„ØµØ§Ù„Ø­Ø©</span>
          </label>
          <label class="chip">
            <input type="checkbox" id="futureSkills">
            <span>Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„</span>
          </label>
        </div>
      </label>

      <div class="actions">
        <button class="btn" type="button" id="saveSession">Ø­ÙØ¸ Ø§Ù„Ø­ØµØ©</button>
        <button class="btn" type="button" id="exportSessions">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ PDF</button>
        <button class="btn danger" type="button" id="clearAll">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ</button>
      </div>
    </form>

    <h3 class="wait-subtitle">Ø§Ù„Ø­ØµØµ Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>Ù…</th><th>Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th><th>Ø§Ù„ÙŠÙˆÙ…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„ØµÙ</th><th>Ø§Ù„Ø­ØµØ©</th><th>Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø§Ù„ØºØ§Ø¦Ø¨Ø©</th>
            <th>Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡</th><th>Ø§Ù„Ù…Ø¬Ø§Ù„</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="sessionsBody"></tbody>
      </table>
    </div>
  </section>

  <!-- Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª -->
  <section id="lab-section" class="card-page" style="display:none;">
    <div class="report-header">
      <h2>ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬</h2>
      <div class="ministry">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="program-title">Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª</div>
    </div>

    <p class="lab-intro">Ø³Ø¬Ù„ÙŠ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ¬Ø§Ø±Ø¨ ÙˆØ§Ù„Ø¨Ø±Ø§Ù…Ø¬ Ø§Ù„Ù…Ù†ÙØ°Ø© ÙÙŠ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª. ÙŠØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹ ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­.</p>

    <form id="labForm" class="form lab-form">
      <div class="grid-3">
        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø© *
          <input class="input" id="labProgram" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ùˆ Ø§Ù„ØªØ¬Ø±Ø¨Ø©">
        </label>
        <label>Ø§Ù„Ù…Ù†ÙØ°Ø© *
          <input class="input" id="labExecutor" required placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ÙØ°Ø©">
        </label>
        <label>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ° *
          <input class="input" id="labLocation" required placeholder="Ù…ÙƒØ§Ù† ØªÙ†ÙÙŠØ° Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬">
        </label>
      </div>

      <div class="grid-3">
        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ† *
          <input class="input" id="labTargetCount" type="number" min="1" required placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†">
        </label>
        <label class="date-with-hijri">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ° (Ù‡Ø¬Ø±ÙŠ) *
          <div class="date-input-container">
            <input class="input hijri-date-input" id="labDate" required placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ" readonly>
            <button type="button" class="hijri-toggle">
              <svg class="hijri-icon" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5zm2 4h10v2H7v-2zm0 4h7v2H7v-2z"/></svg>
            </button>
          </div>
          <div class="hijri-calendar">
            <div class="hijri-header">
              <div class="hijri-month-year"></div>
              <div class="hijri-nav">
                <button type="button" class="prev-year">Â«</button>
                <button type="button" class="prev-month">â€¹</button>
                <button type="button" class="next-month">â€º</button>
                <button type="button" class="next-year">Â»</button>
              </div>
            </div>
            <div class="hijri-weekdays">
              <span>Ø­</span><span>Ù†</span><span>Ø«</span><span>Ø±</span><span>Ø®</span><span>Ø¬</span><span>Ø³</span>
            </div>
            <div class="hijri-days"></div>
            <button type="button" class="today-btn">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</button>
          </div>
        </label>
        <div></div>
      </div>

      <label>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ† *
        <textarea class="input" id="labBeneficiaries" required placeholder="Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø© (Ù…Ø«Ø§Ù„: Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹ØŒ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ø¹Ù„ÙˆÙ…...)"></textarea>
      </label>

      <div class="actions">
        <button class="btn" type="button" id="saveLab">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="btn" type="button" id="exportLabs">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± PDF</button>
        <button class="btn danger" type="button" id="clearLabs">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
      </div>
    </form>

    <h3 class="lab-subtitle">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
    <div class="table-wrap">
      <table class="lab-table">
        <thead>
          <tr>
            <th>Ù…</th><th>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø©</th><th>Ø§Ù„Ù…Ù†ÙØ°Ø©</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†</th>
            <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="labsBody"></tbody>
      </table>
    </div>
  </section>

  <!-- Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù… -->
  <section id="general-section" class="card-page" style="display:none;">
    <div class="report-header" style="background:linear-gradient(135deg,#0f766e,#0e7490);">
      <h2>Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…</h2>
      <div class="ministry">ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ…</div>
      <div class="program-title">ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬ / ÙØ¹Ø§Ù„ÙŠØ©</div>
    </div>

    <p class="general-intro">Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù„ØªÙˆØ«ÙŠÙ‚ Ø£ÙŠ Ø¨Ø±Ù†Ø§Ù…Ø¬ Ø£Ùˆ ÙØ¹Ø§Ù„ÙŠØ© (Ø¹Ø§Ù… / ÙŠÙˆÙ…ÙŠ / Ø£Ø³Ø¨ÙˆØ¹ÙŠ / Ø´Ù‡Ø±ÙŠ).</p>

    <form id="generalForm" class="form">
      <div class="grid-3">
        <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ© *
          <input class="input" id="gProgram" required placeholder="Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©">
        </label>
        <label>Ø§Ù„Ù…Ù†ÙØ°Ø© *
          <input class="input" id="gExecutor" required placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ÙØ°Ø©">
        </label>
        <label>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ° *
          <input class="input" id="gLocation" required placeholder="Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ° (Ù…Ø«Ø§Ù„: Ù…Ø³Ø±Ø­ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©)">
        </label>
      </div>

      <div class="grid-3">
        <label>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ± *
          <select class="input" id="gType" required>
            <option value="">Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„Ù†ÙˆØ¹</option>
            <option>ÙŠÙˆÙ…ÙŠ</option>
            <option>Ø£Ø³Ø¨ÙˆØ¹ÙŠ</option>
            <option>Ø´Ù‡Ø±ÙŠ</option>
            <option>ÙØµÙ„ÙŠ</option>
            <option>Ø¹Ø§Ù…</option>
          </select>
        </label>

        <label class="date-with-hijri">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ° (Ù‡Ø¬Ø±ÙŠ) *
          <div class="date-input-container">
            <input class="input hijri-date-input" id="gDate" required placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ù‡Ø¬Ø±ÙŠ" readonly>
            <button type="button" class="hijri-toggle">
              <svg class="hijri-icon" viewBox="0 0 24 24"><path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V9h14v10zM5 7V5h14v2H5zm2 4h10v2H7v-2zm0 4h7v2H7v-2z"/></svg>
            </button>
          </div>
          <div class="hijri-calendar">
            <div class="hijri-header">
              <div class="hijri-month-year"></div>
              <div class="hijri-nav">
                <button type="button" class="prev-year">Â«</button>
                <button type="button" class="prev-month">â€¹</button>
                <button type="button" class="next-month">â€º</button>
                <button type="button" class="next-year">Â»</button>
              </div>
            </div>
            <div class="hijri-weekdays">
              <span>Ø­</span><span>Ù†</span><span>Ø«</span><span>Ø±</span><span>Ø®</span><span>Ø¬</span><span>Ø³</span>
            </div>
            <div class="hijri-days"></div>
            <button type="button" class="today-btn">Ø§Ø®ØªØ± Ø§Ù„ÙŠÙˆÙ…</button>
          </div>
        </label>

        <label>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ† *
          <input class="input" id="gCount" type="number" min="1" required placeholder="Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†">
        </label>
      </div>

      <label>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ† *
        <textarea class="input" id="gBeneficiaries" required placeholder="Ø§ÙƒØªØ¨ÙŠ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø© (Ù…Ø«Ø§Ù„: Ø·Ø§Ù„Ø¨Ø§Øª Ø§Ù„ØµÙÙˆÙ Ø§Ù„Ø¹Ù„ÙŠØ§ØŒ Ù…Ø¹Ù„Ù…Ø§Øª Ø§Ù„Ù…Ø¯Ø±Ø³Ø©...)"></textarea>
      </label>

      <label>Ø£Ø¨Ø±Ø² Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡ *
        <textarea class="input" id="gDetails" required placeholder="Ø³Ø¬Ù„ÙŠ Ø¨Ø¥ÙŠØ¬Ø§Ø² Ø£Ù‡Ù… Ù…Ø§ ØªÙ… ÙÙŠ Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ÙØ¹Ø§Ù„ÙŠØ©..."></textarea>
      </label>

      <div class="actions">
        <button class="btn" type="button" id="saveGeneral">Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
        <button class="btn" type="button" id="exportGeneral">ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± PDF</button>
        <button class="btn danger" type="button" id="clearGeneral">Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</button>
      </div>
    </form>

    <h3 class="general-subtitle">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø³Ø¬Ù„Ø©</h3>
    <div class="table-wrap">
      <table class="general-table">
        <thead>
          <tr>
            <th>Ù…</th><th>Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬</th><th>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</th>
            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°</th><th>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙŠÙ†</th>
            <th>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†</th><th>Ø£Ø¨Ø±Ø² Ù…Ø§ ØªÙ…</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th>
          </tr>
        </thead>
        <tbody id="generalBody"></tbody>
      </table>
    </div>
  </section>
</main>

<div id="iframe-container">
  <iframe id="content-frame" src="about:blank"></iframe>
</div>

<footer class="site-footer">
  <p>LOBODES</p>
</footer>

<button id="back-btn">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script>
  // =================================================================================
  // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© Ø¹Ø§Ù…Ø©
  // =================================================================================

  function showToast(msg,type=''){
    const t=document.createElement('div');
    t.className='toast'+(type?' '+type:'');
    t.textContent=msg;
    document.body.appendChild(t);
    setTimeout(()=>{t.style.opacity='0';t.style.transition='opacity .25s';},1400);
    setTimeout(()=>{t.remove();},1900);
  }

  function getJsPDF(){
    if(window.jspdf && window.jspdf.jsPDF) return window.jspdf.jsPDF;
    if(window.jsPDF) return window.jsPDF;
    throw new Error('jsPDF library not loaded');
  }

  function captureAsCanvas(el){
    return html2canvas(el,{scale:1.5,backgroundColor:'#ffffff',useCORS:true,logging:false});
  }

  function escapeHtml(text){
    if(!text) return '';
    return String(text)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#039;');
  }

  // =================================================================================
  // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªÙ†Ù‚Ù„
  // =================================================================================

  function loadInIframe(url,title){
    const iframeContainer=document.getElementById('iframe-container');
    const iframe=document.getElementById('content-frame');
    const nav=document.querySelector('nav');
    const localPages=document.getElementById('local-pages');
    const backBtn=document.getElementById('back-btn');

    document.title=(title||'ØªÙ‚Ø±ÙŠØ±')+' - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';

    localPages.style.display='none';
    document.getElementById('wait-section').style.display='none';
    document.getElementById('lab-section').style.display='none';
    document.getElementById('general-section').style.display='none';

    iframe.src=url;
    iframeContainer.style.display='block';
    iframeContainer.scrollIntoView({behavior:'smooth'});
    nav.style.display='block';
    backBtn.style.display='block';

    backBtn.onclick=function(){
      iframeContainer.style.display='none';
      iframe.src='about:blank';
      nav.style.display='block';
      document.title='Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
      backBtn.style.display='none';
    };
  }

  function loadLocal(which){
    const iframeContainer=document.getElementById('iframe-container');
    const nav=document.querySelector('nav');
    const localPages=document.getElementById('local-pages');
    const backBtn=document.getElementById('back-btn');

    iframeContainer.style.display='none';
    document.getElementById('content-frame').src='about:blank';

    localPages.style.display='block';
    document.getElementById('wait-section').style.display= which==='wait' ? 'block' : 'none';
    document.getElementById('lab-section').style.display = which==='lab' ? 'block' : 'none';
    document.getElementById('general-section').style.display = which==='general' ? 'block' : 'none';

    document.title=(which==='wait'?'Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±':which==='lab'?'Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª':'Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…')+' - Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
    nav.style.display='block';
    backBtn.style.display='block';
    localPages.scrollIntoView({behavior:'smooth'});

    backBtn.onclick=function(){
      localPages.style.display='none';
      document.getElementById('wait-section').style.display='none';
      document.getElementById('lab-section').style.display='none';
      document.getElementById('general-section').style.display='none';
      document.title='Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠØ©';
      backBtn.style.display='none';
    };
  }

  // =================================================================================
  // Ø­ØµØ© Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±
  // =================================================================================

  let waitSessions=[];

  function waitLoadSessions(){
    try{
      const saved=localStorage.getItem('w26_waiting_sessions');
      if(saved) waitSessions=JSON.parse(saved)||[];
      renderWaitSessions();
    }catch(e){}
  }
  function waitSaveSessions(){localStorage.setItem('w26_waiting_sessions',JSON.stringify(waitSessions));}

  function renderWaitSessions(){
    const body=document.getElementById('sessionsBody');
    if(!body) return;
    body.innerHTML='';
    waitSessions.forEach((s,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td>
        <td>${escapeHtml(s.week)}</td>
        <td>${escapeHtml(s.day)}</td>
        <td>${escapeHtml(s.date)}</td>
        <td>${escapeHtml(s.className)}</td>
        <td>${escapeHtml(s.number)}</td>
        <td>${escapeHtml(s.teacher)}</td>
        <td class="text-right">${escapeHtml(s.activities)}</td>
        <td class="text-right">${escapeHtml(s.fields)}</td>
        <td><button class="btn danger" style="width:auto;padding:4px 8px;font-size:.75rem;border-radius:999px;box-shadow:none;" onclick="deleteWaitSession(${i})">Ø­Ø°Ù</button></td>`;
      body.appendChild(tr);
    });
  }
  function deleteWaitSession(i){
    if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ø­ØµØ©ØŸ')) return;
    waitSessions.splice(i,1);
    waitSaveSessions();
    renderWaitSessions();
    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø­ØµØ©');
  }

  function initWaitForm(){
    document.getElementById('saveSession').onclick=function(){
      const week=document.getElementById('weekNumber').value;
      const day=document.getElementById('dayName').value;
      const date=document.getElementById('sessionDate').value;
      const className=document.getElementById('className').value.trim();
      const number=document.getElementById('sessionNumber').value.trim();
      const teacher=document.getElementById('absentTeacher').value.trim();
      const activities=document.getElementById('activitiesText').value.trim();
      const fields=[];
      if(document.getElementById('basicSkills').checked) fields.push('Ø§Ù„Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©');
      if(document.getElementById('values').checked) fields.push('Ø§Ù„Ù‚ÙŠÙ… ÙˆØ§Ù„Ù…ÙˆØ§Ø·Ù†Ø© Ø§Ù„ØµØ§Ù„Ø­Ø©');
      if(document.getElementById('futureSkills').checked) fields.push('Ù…Ù‡Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„');

      if(!week||!day||!date||!className||!number||!teacher||!activities||fields.length===0){
        showToast('Ø£ÙƒÙ…Ù„ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ ÙˆØ§Ø®ØªØ± Ù…Ø¬Ø§Ù„Ø§Ù‹ ÙˆØ§Ø­Ø¯Ø§Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„','warn');
        return;
      }
      waitSessions.push({week,day,date,className,number,teacher,activities,fields:fields.join('ØŒ ')});
      waitSaveSessions();
      renderWaitSessions();
      document.getElementById('sesForm').reset();
      showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø­ØµØ©');
    };

    document.getElementById('clearAll').onclick=function(){
      if(!waitSessions.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      if(!confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±ØŸ')) return;
      waitSessions=[];
      waitSaveSessions();
      renderWaitSessions();
      showToast('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­ØµØµ');
    };

    document.getElementById('exportSessions').onclick=async function(){
      if(!waitSessions.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­ØµØµ Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      showToast('Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...','warn');

      const printDiv=document.createElement('div');
      printDiv.style.cssText="position:fixed;top:0;left:0;width:1123px;background:#fff;padding:30px;z-index:3000;direction:rtl;font-family:'Tajawal',sans-serif;font-size:14px;";

      let rows='';
      waitSessions.forEach((s,i)=>{
        rows+=`<tr>
          <td style="border:1px solid #bbf7d0;padding:6px;">${i+1}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.week||'')}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.day)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.date)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.className)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.number)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;">${escapeHtml(s.teacher)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;text-align:right;">${escapeHtml(s.activities)}</td>
          <td style="border:1px solid #bbf7d0;padding:6px;text-align:right;">${escapeHtml(s.fields)}</td>
        </tr>`;
      });

      printDiv.innerHTML=`
        <div style="text-align:center;margin-bottom:14px;">
          <img src="https://raw.githubusercontent.com/omymh/school26/main/26.png" style="width:100%;height:60px;object-fit:contain;margin-bottom:6px;">
          <h1 style="color:#047857;font-size:20px;margin:0 0 6px;font-weight:900;border-bottom:1px solid #bbf7d0;padding-bottom:6px;">ØªÙ‚Ø§Ø±ÙŠØ± Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</h1>
        </div>
        <table style="width:100%;border-collapse:collapse;font-size:13px;">
          <thead>
            <tr>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ù…</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„ÙŠÙˆÙ…</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„ØµÙ</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„Ø­ØµØ©</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø§Ù„ØºØ§Ø¦Ø¨Ø©</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡</th>
              <th style="border:1px solid #bbf7d0;background:#16a34a;color:#fff;padding:6px;">Ø§Ù„Ù…Ø¬Ø§Ù„</th>
            </tr>
          </thead>
          <tbody>${rows}</tbody>
        </table>
        <div style="margin-top:20px;padding-top:6px;border-top:1px solid #bbf7d0;text-align:left;direction:ltr;">
          <p style="margin:0 0 3px;font-weight:bold;color:#047857;font-size:14px;">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
          <p style="margin:0;font-size:14px;color:#047857;">Ø£Ù…Ø§Ù†ÙŠ Ø¢Ù„ Ø¹Ø¨Ø´Ø§Ù†</p>
        </div>
      `;

      document.body.appendChild(printDiv);
      const canvas=await captureAsCanvas(printDiv);
      document.body.removeChild(printDiv);

      const imgData=canvas.toDataURL('image/jpeg',0.95);
      const JsPDF=getJsPDF();
      const pdf=new JsPDF({orientation:'landscape',unit:'mm',format:'a4'});
      const pageWidth=pdf.internal.pageSize.getWidth();
      const pageHeight=pdf.internal.pageSize.getHeight();
      const imgWidth=pageWidth;
      const imgHeight=(canvas.height*imgWidth)/canvas.width;
      let heightLeft=imgHeight,pos=0;

      pdf.addImage(imgData,'JPEG',0,pos,imgWidth,imgHeight);
      heightLeft-=pageHeight;
      while(heightLeft>0){
        pos=heightLeft-imgHeight;
        pdf.addPage();
        pdf.addImage(imgData,'JPEG',0,pos,imgWidth,imgHeight);
        heightLeft-=pageHeight;
      }
      pdf.save('ØªÙ‚Ø§Ø±ÙŠØ± Ø­ØµØµ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±.pdf');
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù PDF');
    };
  }

  // =================================================================================
  // Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
  // =================================================================================

  let labExperiments=[];
  function loadLab(){
    try{
      const saved=localStorage.getItem('w26_lab_experiments');
      if(saved) labExperiments=JSON.parse(saved)||[];
      renderLab();
    }catch(e){}
  }
  function saveLab(){localStorage.setItem('w26_lab_experiments',JSON.stringify(labExperiments));}
  function renderLab(){
    const body=document.getElementById('labsBody');
    if(!body) return;
    body.innerHTML='';
    labExperiments.forEach((e,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td>
        <td class="text-right">${escapeHtml(e.program)}</td>
        <td>${escapeHtml(e.executor)}</td>
        <td>${escapeHtml(e.date)}</td>
        <td>${escapeHtml(e.targetCount)}</td>
        <td class="text-right">${escapeHtml(e.beneficiaries)}</td>
        <td><button class="btn danger" style="width:auto;padding:4px 8px;font-size:.75rem;border-radius:999px;box-shadow:none;" onclick="deleteLab(${i})">Ø­Ø°Ù</button></td>`;
      body.appendChild(tr);
    });
  }
  function deleteLab(i){
    if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ÙŠÙ† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ')) return;
    labExperiments.splice(i,1);
    saveLab();
    renderLab();
    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
  }
  function initLabForm(){
    document.getElementById('saveLab').onclick=function(){
      const program=document.getElementById('labProgram').value.trim();
      const executor=document.getElementById('labExecutor').value.trim();
      const location=document.getElementById('labLocation').value.trim();
      const targetCount=document.getElementById('labTargetCount').value.trim();
      const date=document.getElementById('labDate').value.trim();
      const beneficiaries=document.getElementById('labBeneficiaries').value.trim();
      if(!program||!executor||!location||!targetCount||!date||!beneficiaries){
        showToast('Ø£ÙƒÙ…Ù„ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©','warn');
        return;
      }
      labExperiments.push({program,executor,location,targetCount,date,beneficiaries});
      saveLab();
      renderLab();
      document.getElementById('labForm').reset();
      showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
    };
    document.getElementById('clearLabs').onclick=function(){
      if(!labExperiments.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      if(!confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§ØªØŸ')) return;
      labExperiments=[];
      saveLab();
      renderLab();
      showToast('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');
    };
    document.getElementById('exportLabs').onclick=async function(){
      if(!labExperiments.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      showToast('Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...','warn');

      const JsPDF=getJsPDF();
      const pdf=new JsPDF({orientation:'portrait',unit:'mm',format:'a4'});
      const pageWidth=pdf.internal.pageSize.getWidth();

      for(let i=0;i<labExperiments.length;i++){
        const exp=labExperiments[i];
        const printDiv=document.createElement('div');
        printDiv.style.cssText="position:fixed;top:0;left:0;width:794px;background:#fff;padding:40px 40px 30px;z-index:3000;direction:rtl;font-family:'Tajawal',sans-serif;font-size:15px;";

        printDiv.innerHTML=`
          <div style="flex:1;display:flex;flex-direction:column;">
            <div style="text-align:center;margin-bottom:24px;">
              <img src="https://raw.githubusercontent.com/omymh/school26/main/26.png"
                   crossorigin="anonymous"
                   style="width:100%;height:70px;object-fit:contain;margin-bottom:8px;">
              <div style="font-weight:800;font-size:18px;margin-top:4px;">ØªÙ‚Ø±ÙŠØ± ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬</div>
              <div style="margin-top:8px;font-size:15px;font-weight:700;">
                <span>Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„ØªØ¬Ø±Ø¨Ø©:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(exp.program || '')}</span>
              </div>
            </div>

            <div style="border:2px solid #bbf7d0;border-radius:12px;padding:18px 14px;line-height:2;">
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø§Ù„Ù…Ù†ÙØ°Ø©:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(exp.executor || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ°:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(exp.location || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(exp.targetCount || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø§Ù„Ù…Ø³ØªÙÙŠØ¯ÙˆÙ†:</span>
                <span style="padding-right:6px;font-weight:500;white-space:pre-wrap;">${escapeHtml(exp.beneficiaries || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;">
                <span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(exp.date || '')} Ù‡Ù€</span>
              </div>
            </div>
          </div>

          <div style="margin-top:24px;padding-top:10px;border-top:1px solid #bbf7d0;">
            <div style="display:flex;justify-content:flex-start;direction:ltr;">
              <div style="text-align:left;">
                <p style="margin:0 0 3px;font-weight:bold;color:#047857;font-size:14px;">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
                <p style="margin:0;font-size:14px;color:#047857;">Ø£Ù…Ø§Ù†ÙŠ Ø¢Ù„ Ø¹Ø¨Ø´Ø§Ù†</p>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(printDiv);
        const canvas=await captureAsCanvas(printDiv);
        document.body.removeChild(printDiv);

        const imgData=canvas.toDataURL('image/jpeg',0.95);
        const imgWidth=pageWidth;
        const imgHeight=(canvas.height*imgWidth)/canvas.width;
        const positionY=0;

        if(i>0) pdf.addPage();
        pdf.addImage(imgData,'JPEG',0,positionY,imgWidth,imgHeight);
      }

      pdf.save('ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª.pdf');
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù PDF');
    };
  }

  // =================================================================================
  // Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…
  // =================================================================================

  let generalReports=[];
  function loadGeneral(){
    try{
      const saved=localStorage.getItem('w26_general_reports');
      if(saved) generalReports=JSON.parse(saved)||[];
      renderGeneral();
    }catch(e){}
  }
  function saveGeneral(){localStorage.setItem('w26_general_reports',JSON.stringify(generalReports));}
  function renderGeneral(){
    const body=document.getElementById('generalBody');
    if(!body) return;
    body.innerHTML='';
    generalReports.forEach((g,i)=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${i+1}</td>
        <td class="text-right">${escapeHtml(g.program)}</td>
        <td>${escapeHtml(g.type)}</td>
        <td>${escapeHtml(g.date)}</td>
        <td>${escapeHtml(g.count)}</td>
        <td class="text-right">${escapeHtml(g.beneficiaries)}</td>
        <td class="text-right">${escapeHtml(g.details)}</td>
        <td><button class="btn danger" style="width:auto;padding:4px 8px;font-size:.75rem;border-radius:999px;box-shadow:none;" onclick="deleteGeneral(${i})">Ø­Ø°Ù</button></td>`;
      body.appendChild(tr);
    });
  }
  function deleteGeneral(i){
    if(!confirm('Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±ØŸ')) return;
    generalReports.splice(i,1);
    saveGeneral();
    renderGeneral();
    showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
  }
  function initGeneralForm(){
    document.getElementById('saveGeneral').onclick=function(){
      const program=document.getElementById('gProgram').value.trim();
      const executor=document.getElementById('gExecutor').value.trim();
      const location=document.getElementById('gLocation').value.trim();
      const type=document.getElementById('gType').value;
      const date=document.getElementById('gDate').value.trim();
      const count=document.getElementById('gCount').value.trim();
      const beneficiaries=document.getElementById('gBeneficiaries').value.trim();
      const details=document.getElementById('gDetails').value.trim();
      if(!program||!executor||!location||!type||!date||!count||!beneficiaries||!details){
        showToast('Ø£ÙƒÙ…Ù„ÙŠ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„','warn');return;
      }
      generalReports.push({program,executor,location,type,date,count,beneficiaries,details});
      saveGeneral();
      renderGeneral();
      document.getElementById('generalForm').reset();
      showToast('ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø±ÙŠØ±');
    };
    document.getElementById('clearGeneral').onclick=function(){
      if(!generalReports.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      if(!confirm('Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…ØŸ')) return;
      generalReports=[];
      saveGeneral();
      renderGeneral();
      showToast('ØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±');
    };
    document.getElementById('exportGeneral').onclick=async function(){
      if(!generalReports.length){showToast('Ù„Ø§ ØªÙˆØ¬Ø¯ ØªÙ‚Ø§Ø±ÙŠØ± Ù…Ø³Ø¬Ù„Ø©','warn');return;}
      showToast('Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ù…Ù„Ù PDF...','warn');

      const JsPDF=getJsPDF();
      const pdf=new JsPDF({orientation:'portrait',unit:'mm',format:'a4'});
      const pageWidth=pdf.internal.pageSize.getWidth();

      for(let i=0;i<generalReports.length;i++){
        const rep=generalReports[i];
        const printDiv=document.createElement('div');
        printDiv.style.cssText="position:fixed;top:0;left:0;width:794px;background:#fff;padding:40px 40px 30px;z-index:3000;direction:rtl;font-family:'Tajawal',sans-serif;font-size:15px;";

        printDiv.innerHTML=`
          <div style="flex:1;display:flex;flex-direction:column;">
            <div style="text-align:center;margin-bottom:24px;">
              <img src="https://raw.githubusercontent.com/omymh/school26/main/26.png"
                   crossorigin="anonymous"
                   style="width:100%;height:70px;object-fit:contain;margin-bottom:8px;">
              <div style="font-weight:800;font-size:18px;margin-top:4px;">ØªÙ‚Ø±ÙŠØ± Ø¹Ø§Ù… Ù„ØªÙ†ÙÙŠØ° Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ù†Ø´Ø§Ø·</div>
              <div style="margin-top:8px;font-size:15px;font-weight:700;">
                <span>Ù†ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ±:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.type || '')}</span>
              </div>
              <div style="margin-top:4px;font-size:15px;font-weight:700;">
                <span>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø§Ù„Ù†Ø´Ø§Ø·:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.program || '')}</span>
              </div>
            </div>

            <div style="border:2px solid #bbf7d0;border-radius:12px;padding:18px 14px;line-height:2;">
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø§Ù„Ù…Ù†ÙØ° / Ø§Ù„Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ÙØ°Ø©:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.executor || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ù…ÙƒØ§Ù† Ø§Ù„ØªÙ†ÙÙŠØ°:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.location || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙŠÙ†:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.count || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø§Ù„ÙØ¦Ø© Ø§Ù„Ù…Ø³ØªÙÙŠØ¯Ø©:</span>
                <span style="padding-right:6px;font-weight:500;white-space:pre-wrap;">${escapeHtml(rep.beneficiaries || '')}</span>
              </div>
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°:</span>
                <span style="padding-right:6px;font-weight:500;">${escapeHtml(rep.date || '')} Ù‡Ù€</span>
              </div>
              <hr style="border:none;border-top:1px dashed #bbf7d0;margin:10px 0;">
              <div style="font-size:15px;font-weight:700;margin-bottom:4px;">
                <span>Ø£Ø¨Ø±Ø² Ù…Ø§ ØªÙ… ØªÙ†ÙÙŠØ°Ù‡:</span>
                <span style="padding-right:6px;font-weight:500;white-space:pre-wrap;">${escapeHtml(rep.details || '')}</span>
              </div>
            </div>
          </div>

          <div style="margin-top:24px;padding-top:10px;border-top:1px solid #bbf7d0;">
            <div style="display:flex;justify-content:flex-start;direction:ltr;">
              <div style="text-align:left;">
                <p style="margin:0 0 3px;font-weight:bold;color:#047857;font-size:14px;">Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</p>
                <p style="margin:0;font-size:14px;color:#047857;">Ø£Ù…Ø§Ù†ÙŠ Ø¢Ù„ Ø¹Ø¨Ø´Ø§Ù†</p>
              </div>
            </div>
          </div>
        `;

        document.body.appendChild(printDiv);
        const canvas=await captureAsCanvas(printDiv);
        document.body.removeChild(printDiv);

        const imgData=canvas.toDataURL('image/jpeg',0.95);
        const imgWidth=pageWidth;
        const imgHeight=(canvas.height*imgWidth)/canvas.width;
        const positionY=0;

        if(i>0) pdf.addPage();
        pdf.addImage(imgData,'JPEG',0,positionY,imgWidth,imgHeight);
      }

      pdf.save('Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø¹Ø§Ù…Ø©.pdf');
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ù…Ù„Ù PDF');
    };
  }

  // =================================================================================
  // Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ø§Ù„Ù…Ø¨Ø³Ø·
  // =================================================================================

  let currentHijriYear=1447,currentHijriMonth=1;
  const HIJRI_MONTH_NAMES=['Ù…Ø­Ø±Ù…','ØµÙØ±','Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø£ÙˆÙ„','Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¢Ø®Ø±','Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø£ÙˆÙ„Ù‰','Ø¬Ù…Ø§Ø¯Ù‰ Ø§Ù„Ø¢Ø®Ø±Ø©','Ø±Ø¬Ø¨','Ø´Ø¹Ø¨Ø§Ù†','Ø±Ù…Ø¶Ø§Ù†','Ø´ÙˆØ§Ù„','Ø°Ùˆ Ø§Ù„Ù‚Ø¹Ø¯Ø©','Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø©'];
  // Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚ÙˆÙŠÙ… Ù‡Ùˆ ØªÙ‚ÙˆÙŠÙ… Ù…Ø¨Ø³Ø· ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ 30 ÙŠÙˆÙ… Ù„ÙƒÙ„ Ø´Ù‡Ø± Ù„ØºØ±Ø¶ Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹
  // ÙˆÙ„Ø§ ÙŠØ¹ØªÙ…Ø¯ Ø¹Ù„Ù‰ Ø®ÙˆØ§Ø±Ø²Ù…ÙŠØ§Øª ØªØ­ÙˆÙŠÙ„ Ø¯Ù‚ÙŠÙ‚Ø©

  function getTodayHijri(){
    // Ø§ÙØªØ±Ø§Ø¶ ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ… Ø§Ù„Ù‡Ø¬Ø±ÙŠ Ù„ØºØ±Ø¶ Ø§Ù„Ø¹Ø±Ø¶
    const t=new Date();
    return `1447/${t.getMonth()+1}/${t.getDate()}`;
  }

  function renderHijriCalendar(calendar,input){
    calendar.associatedInput=input;
    const monthYear=calendar.querySelector('.hijri-month-year');
    const daysContainer=calendar.querySelector('.hijri-days');

    monthYear.textContent=HIJRI_MONTH_NAMES[currentHijriMonth-1]+' '+currentHijriYear;
    const daysInMonth=30; // ØªØ¨Ø³ÙŠØ·: 30 ÙŠÙˆÙ… Ù„ÙƒÙ„ Ø´Ù‡Ø±
    let html='';
    for(let d=1;d<=daysInMonth;d++) html+=`<div class="hijri-day">${d}</div>`;
    daysContainer.innerHTML=html;

    daysContainer.querySelectorAll('.hijri-day').forEach(day=>{
      day.onclick=function(){
        const val=`${currentHijriYear}/${currentHijriMonth}/${this.textContent}`;
        input.value=val;
        calendar.classList.remove('active');
        showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ØªØ§Ø±ÙŠØ®');
      };
    });
  }

  function initHijriCalendars(){
    const hijriInputs=document.querySelectorAll('.hijri-date-input');
    const calendars=document.querySelectorAll('.hijri-calendar');

    hijriInputs.forEach((input,idx)=>{
      const calendar=calendars[idx];
      const toggle=input.parentElement.querySelector('.hijri-toggle');

      toggle.addEventListener('click',e=>{
        e.preventDefault();e.stopPropagation();
        calendars.forEach(c=>c.classList.remove('active'));
        calendar.classList.toggle('active');
        if(calendar.classList.contains('active')) renderHijriCalendar(calendar,input);
      });

      document.addEventListener('click',e=>{
        if(!calendar.contains(e.target) && e.target!==toggle) calendar.classList.remove('active');
      });
      calendar.addEventListener('click',e=>e.stopPropagation());

      const prevYear=calendar.querySelector('.prev-year');
      const prevMonth=calendar.querySelector('.prev-month');
      const nextMonth=calendar.querySelector('.next-month');
      const nextYear=calendar.querySelector('.next-year');
      const todayBtn=calendar.querySelector('.today-btn');

      prevYear.onclick=()=>{currentHijriYear--;renderHijriCalendar(calendar,input);};
      nextYear.onclick=()=>{currentHijriYear++;renderHijriCalendar(calendar,input);};
      prevMonth.onclick=()=>{
        currentHijriMonth--;
        if(currentHijriMonth<1){currentHijriMonth=12;currentHijriYear--;}
        renderHijriCalendar(calendar,input);
      };
      nextMonth.onclick=()=>{
        currentHijriMonth++;
        if(currentHijriMonth>12){currentHijriMonth=1;currentHijriYear++;}
        renderHijriCalendar(calendar,input);
      };
      todayBtn.onclick=()=>{input.value=getTodayHijri();calendar.classList.remove('active');showToast('ØªÙ… Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…');};
    });
  }

  // =================================================================================
  // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
  // =================================================================================

  function initializeApp(){
    waitLoadSessions();
    initWaitForm();
    loadLab();
    initLabForm();
    loadGeneral();
    initGeneralForm();
    initHijriCalendars();
  }

  document.addEventListener('DOMContentLoaded',initializeApp);
</script>
</body>
</html>
